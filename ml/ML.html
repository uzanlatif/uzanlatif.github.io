<!DOCTYPE html>
<html>
  <head>
    <title>My ML Web App</title>
    <link rel="stylesheet" href="ml.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0/dist/tf.min.js"></script>
  </head>
  <body>
    <center>
      <div id="myBox" class="text-center">
        <h1>BODY FAT MEASUREMENT</h1>
        <form id="image-form">
          <img id="selected-image" src="" alt="Selected Image" class="container" style="width: 200px; display:none;">
          <input type="file" id="input-image" accept="image/*,.heic">
          <br>
          <button type="submit" class="btn btn-success">Predict</button>
        </form>
        <div id="output-container" class="mt-3"></div>
      </div>
    </center>

    <script>
      async function loadModel() {
        const outputContainer = document.getElementById('output-container');
        const selectedImageElement = document.getElementById('selected-image');

        const modelUrl = 'theModel/NewModel/model.json';
        const model = await tf.loadLayersModel(modelUrl);

        const inputElement = document.getElementById('input-image');
        const img = new Image();

        img.onload = async () => {
          // Display the selected image
          selectedImageElement.src = URL.createObjectURL(inputElement.files[0]);
          selectedImageElement.style.display = 'block';

          const tensor = tf.browser.fromPixels(img).resizeBilinear([224, 224]).expandDims(0);
          const prediction = model.predict(tensor);
          const predictionValue = await prediction.data();

          const classes = ['low', 'normal', 'high', 'very high'];
          let maxIndex = 0;
          for (let i = 1; i < predictionValue.length; i++) {
            if (predictionValue[i] > predictionValue[maxIndex]) {
              maxIndex = i;
            }
          }
          const predictedClass = classes[maxIndex];
          const confidencePercentage = (predictionValue[maxIndex] * 100).toFixed(2);

          const predictedClassElement = document.createElement('h1');
          predictedClassElement.innerText = `Predicted class: ${predictedClass}`;

          const confidenceElement = document.createElement('h2');
          confidenceElement.innerText = `Confidence: ${confidencePercentage}%`;
          outputContainer.innerHTML = '';
          outputContainer.appendChild(predictedClassElement);
          outputContainer.appendChild(confidenceElement);
        };

        img.src = URL.createObjectURL(inputElement.files[0]);
      }

      const formElement = document.getElementById('image-form');
      formElement.addEventListener('submit', (event) => {
        event.preventDefault();
        loadModel();
      });

    </script>
  </body>
</html>
